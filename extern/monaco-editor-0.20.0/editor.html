<!DOCTYPE html>
<!-- This file will be copied to the host/components/monaco after build so that any changes made will be reflected in that build-->
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="./min/vs/editor/editor.main.css" />
</head>

<body>
    <div id="container" style="width: 100%; height: 300px;"></div>
    <!-- 
            the "loader.js" adds the editor and initializes the require variable
            the "editor.main.js" inits and defines the MonacoEditor
            the "editor.main.nls.js" defines the key bindings and definitions of the Monaco Editor
        -->

    <script>
        var require = { paths: { vs: './min/vs' } };
    </script>
    <script src="./min/vs/loader.js"></script>
    <script src="./min/vs/editor/editor.main.nls.js"></script>
    <script src="./min/vs/editor/editor.main.js"></script>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script src="./qtQuick.js" type="text/javascript"></script>
    <script type="text/javascript">
        new QWebChannel(qt.webChannelTransport, function (channel) {
            // all published objects are available in channel.objects under
            // the identifier set in their attached WebChannel.id property
            var link = channel.objects.valueLink;

            link.setValue.connect(function (value) {
                editor.setValue(value);
            });

            link.setContainerHeight.connect(function (height) {
                document.getElementById("container").setAttribute("style", `height:${height}px`);
                editor.layout()
            });

            link.setContainerWidth.connect(function (width) {
                document.getElementById("container").setAttribute("style", `width:${width}px`);
                editor.layout()
            });

            link.goToUUID.connect(function (uuid){
                searchForUUID(uuid)
                link.checkForErrors(err_flag,err_msg)
                err_flag = false
            })

            link.undo.connect(function () {
                editor.trigger('undoClicked', 'undo');
            });

            link.resetContainer.connect(function (height, width) {
                document.getElementById("container").setAttribute("style", `height:${height}px`);
                document.getElementById("container").setAttribute("style", `width:${width}px`);
                editor.layout()
            })

            link.redo.connect(function () {
                editor.trigger('redoClicked', 'redo');
            });

            editor.getModel().onDidChangeContent((event) => {
                link.fileText = editor.getValue();
                link.setVersionId(editor.getModel().getAlternativeVersionId());
                
            });
        });
    </script>
    <script>
        if(!isInitialized){
            flags.sgwidgetsFlag = true
            flags.qtQuickFlag = true
            initializeQtQuick(flags)
            for (var i = 0; i < BasicItemProperties.length; i++) {
                suggestions[BasicItemProperties[i]] = {
                    label: BasicItemProperties[i],
                    kind: monaco.languages.CompletionItemKind.Property,
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    insertText: BasicItemProperties[i],
                    range: null,
                }
            }
            for (const [key] of Object.entries(qtObjectKeyValues)) {
                suggestions[key] = {
                    label: qtObjectKeyValues[key].label,
                    kind: monaco.languages.CompletionItemKind.Class,
                    insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                    insertText: qtObjectKeyValues[key].insertText,
                    range: null,
                }
            }
            registerQmlAsLanguage()
        } else {
            editor.dispose()
        } 
    </script>
</body>

</html>
